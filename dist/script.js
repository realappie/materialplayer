var everythingLoaded=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(everythingLoaded),$("input[type=range]").show(),playable=!0)},10),playable=!1,playlist=[{name:"Interstellar",artist:"Hans Zimmer",albumart:"Images/Interstellar.jpg",color:"red",album:[{path:"Music/Interstellar/Dreaming of the crash.mp3",name:"Dreaming Of The Crash"},{path:"Music/Interstellar/Dust.mp3",name:"Dust"},{path:"Music/Interstellar/Mountains.mp3",name:"Mountains"},{path:"Music/Interstellar/Afraid of Time.mp3",name:"Afraid Of Time"},{path:"Music/Interstellar/Running Out.mp3",name:"Running Out"},{path:"Music/Interstellar/Coward.mp3",name:"Coward"}]},{name:"18 months",artist:"Calvin Harris",albumart:"Images/18-Months.png",color:"blue",album:[{path:"Music/18 months/Feel So Close.mp3",name:"Feel So Close"},{path:"Music/18 months/I Need Your Love.mp3",name:"I Need Your Love"},{path:"Music/18 months/Sweet Nothing.mp3",name:"Sweet Nothing"},{path:"Music/18 months/Thinking About You.mp3",name:"Thinking About You"},{path:"Music/18 months/We'll Be Coming Back.mp3",name:"We'll Be Coming Back"}]},{name:"The Dark Knight rises",artist:"Hans Zimmer",albumart:"Images/batman.png",color:"red",album:[{path:"Music/batman/Gotham's Reckoning.mp3",name:"Gotham's Reckoning"},{path:"Music/batman/Mind if I cut in.mp3",name:"Mind if I cut in ?"},{path:"Music/batman/Despair.mp3",name:"Despair"},{path:"Music/batman/Fear will find you.mp3",name:"Fear Will Find you"},{path:"Music/batman/Rise.mp3",name:"Rise"}]},{name:"Dawn of Justice",artist:"Hans Zimmer",albumart:"Images/batmanvsuperman.jpg",color:"yellow",album:[{path:"Music/batmanvsuperman/Beautiful Lie.mp3",name:"Beautiful Lie"},{path:"Music/batmanvsuperman/Red capes are coming.mp3",name:"The Red Capes Are Coming"},{path:"Music/batmanvsuperman/Problems up here.mp3",name:"Problems Up Here"},{path:"Music/batmanvsuperman/Is she with you.mp3",name:"Is She With You?"}]}],app=angular.module("musicPlayer",["firebase"]);app.constant("firebaseUrl","https://materialplayer.firebaseio.com/").service("rootRef",["firebaseUrl",Firebase]).controller("mainController",["$scope","$firebaseObject","rootRef",function(e,a,t){function n(e){$("#toast").toggleClass("animate").children("#toastText").text(e),setTimeout(function(){$("#toast").toggleClass("animate")},3e3)}e.playlist=playlist,e.songIndex=0,e.albumIndex=0,e.currentTime=0,e.currentTimeFormatted=0,e.volume=.5,e.artist=e.playlist[0].artist,e.song=e.playlist[0].album[0].name,e.devicesCount=0,e.inControl=!1,e.receiving=!1,e.loggedIn=!1,e.time=function(e){audio.currentTime=e,$("#progress").css("margin-left",e*pps)},e.loaded=function(e){if(0===e)for(var a=0,t=0;a<$(".albumCard").length;a++,t+=100)$(".albumCard").eq(a).css({"transition-delay":t+"ms"});1===e&&componentHandler.upgradeAllRegistered()},angular.element(document).ready(function(){function o(e,a){function t(){for(var e=0;e<n.length;e++)n[e].toggleClass("noTransition")}if("play"==e&&($("#fabGhost").toggleClass("ripple"),$("#play")[0].id="pause",$("#progressContainer").addClass("animate"),$("#fabIcon").fadeOut(100).html("pause").fadeIn(10),$(".songInfo").toggleClass("slide"),$(".cntrl").toggleClass("animate").delay(500).fadeToggle(300),$("#volume").parents().eq(0).fadeToggle(1e3).toggleClass("animate")),"pause"==e){if(a){var n=[$("#fabGhost"),$("#progressContainer"),$("#pause"),$(".songInfo"),$(".cntrl"),$("#volume")];t(),setTimeout(function(){t()},200),$("#fabIcon").fadeOut(0).html("play_arrow").fadeIn(0)}else $("#fabIcon").fadeOut(100).html("play_arrow").fadeIn(10);$("#fabGhost").toggleClass("ripple"),$("#pause")[0].id="play",$("#progressContainer").removeClass("animate"),$(".songInfo").toggleClass("slide"),$(".cntrl").toggleClass("animate").delay(100).fadeToggle(100),$("#volume").parents().eq(0).fadeToggle(0).toggleClass("animate")}}function i(e){return e>=60&&(m.formatted=e,(e.toString().length=1)&&(e="0"+e.toString(),m.formatted=e)),3599>=e&&(m.minutes=Math.floor(e/60),m.seconds=e-60*m.minutes,1==m.seconds.toString().length&&(m.seconds="0"+m.seconds.toString(),m.formatted=m.seconds),m.formatted=m.minutes+":"+m.seconds),e>=3600&&(m.hours=Math.floor(e/3600),m.minutes=Math.floor((e-3600*m.hours)/60),m.seconds=e-(60*m.minutes+3600*m.hours),m.formatted=m.hours+":"+m.minutes),m.formatted}function s(e,a){e.once("value",function(e){a.set(e.val(),function(e){e&&"undefined"!=typeof console&&console.error})})}function r(){this.uid=arguments[0],this.name=arguments[1],this.profilePicture=arguments[2],this.ratingList={};var o={uid:arguments[0],name:arguments[1],profilePicture:arguments[2]},i=0,r=0,l=t.child("/users/"),u=(t.child("//registeredUsers/"),t.child("/users/{0}/devices/registered/".format(o.uid))),m=t.child("/users/{0}/devices/online".format(o.uid)),c=t.child("/users/{0}/rating".format(o.uid)),d={},g=encodeURIComponent(navigator.userAgent).replace(/%20/g,"+"),p="https://useragentapi.com/api/v3/json/f9a41846/"+g,f=function(a){$.get(p,function(t){d.browser=t.data.browser_name,d.name=t.data.platform_type,u.child(a).set({userAgent:navigator.userAgent,name:d.name,browser:d.browser,created:Date.now(),key:a,playingInfo:{time:0,songIndex:0,albumIndex:0,volume:.5},controlStatus:{inControl:e.inControl,receiving:e.receiving}}),s(u.child(a),m.child(a))}).fail(function(){})};t.child("registeredUsers/{0}".format(o.uid)).once("value",function(c){null===c?(t.child("registeredUsers/"+o.uid).set({name:o.name,registered:Date.now()}),l.child(o.uid).set(o),f(0),m.child(r).onDisconnect().remove(),n("Welcome, "+o.name)):u.once("value",function(o){function l(){e.writeData.$destroy(),e.readData.$watch(function(){audio.volume=e.readData.volume,$("#volume")[0].MaterialSlider.change(100*e.readData.volume),e.songIndex!==e.readData.songIndex&&(e.songIndex=e.readData.songIndex,e.changeAudio(e.albumIndex,e.songIndex)),e.albumIndex!==e.readData.albumIndex&&(e.albumIndex=e.readData.albumIndex,e.changeAlbum(e.albumIndex,e.readData.songIndex)),e.currentTime!==e.readData.time,e.currentTime!==e.readData.time&&(e.currentTime>=e.readData.time-2&&e.currentTime<=e.readData.time+2||(e.currentTime=e.readData.time,audio.currentTime=e.readData.time,$("#progress").css({"margin-left":pps*audio.currentTime})))})}i=o.numChildren();var c=!0;for(key in o.val())navigator.userAgent==o.val()[key].userAgent&&(c=!1,r=key);if(c&&(f(i),r=i,m.child(r).onDisconnect().remove()),!c){var d=!0;m.once("value",function(o){null==o.val()||o.val()[r]&&(n("Device already connected in another tab"),t.unauth(),e.loggedIn=!1,d=!1,m.child(r).onDisconnect().cancel(),e.$apply()),d&&(n("Device connected"),s(u.child(r),m.child(r)),m.child(r).onDisconnect().remove(),e.writeData=a(m.child(r+"/playingInfo")),e.$watch("[albumIndex,songIndex,currentTime,volume,inControl,receiving]",function(){e.playingInfo={time:e.currentTime,songIndex:e.songIndex,albumIndex:e.albumIndex,volume:e.volume}},!0),e.writeData.$bindTo(e,"playingInfo"))})}var g=a(m.child(r+"/controlStatus/"));g.$watch(function(){g.receiving&&(e.receiving=!0,l())}),e.readData=a(m.child(r+"/playingInfo"))})}),e.changeDevice=function(){e.remoteInfo=a(m.child(e.selectedDevice.key+"/playingInfo"))},e.devices=a(u),e.control=function(t){e.inControl=!0,audio.volume=0,void 0===t&&(e.selectedReadData=a(m.child(e.selectedDevice.key+"/playingInfo")),e.selectedReadData.$bindTo(e,"playingInfo"),m.child(e.selectedDevice.key+"/controlStatus").update({receiving:!0}),m.child(e.selectedDevice.key).on("child_removed",function(a){e.selectedReadData.$destroy()}))},e.ratingList=a(c),this.rateAlbum=function(a,t){e.ratingList[a]=t,e.ratingList.$save()},this.logout=function(){e.writeData.$destroy(),e.readData.$destroy(),e.ratingList.$destroy(),m.child(r).remove(),t.unauth()}}function l(e){if(e)for(var a=0;e>a;a++)$("#rating .material-icons").eq(a).html("star");else $("#rating .material-icons.star").html("star_border")}var u=function(){for(var e="clipPath",a=["webkit","moz","ms","o"],t=[e],n=document.createElement("testelement"),o="polygon(50% 0%, 0% 100%, 100% 100%)",i=0,s=a.length;s>i;i++){var r=a[i]+e.charAt(0).toUpperCase()+e.slice(1);t.push(r)}for(var i=0,s=t.length;s>i;i++){var l=t[i];if(""===n.style[l]&&(n.style[l]=o,""!==n.style[l]))return!0}return!1};u()||($(".clipSpecefic").hide(),$("#errorMessage").show());var m={};Audio.prototype.prepare=function(){this.onloadedmetadata=function(){m.totalSeconds=Math.floor(this.duration),pps=($("#progressBar").width()-2)/m.totalSeconds},this.oncanplaythrough=function(){this.playable=!0},e.inControl&&(audio.volume=0)},audio=new Audio(playlist[e.albumIndex].album[0].path),audio.prepare(),Audio.prototype.stop=function(){audio.pause(),$("#progress").css("margin-left","0"),this.currentTime=0},audio.onwaiting=function(){for(var e=0;e<audio.buffered.length;e++){audio.buffered.start(e),audio.buffered.end(e)}},audio.addEventListener("waiting",function(){for(var e=0;e<audio.buffered.length;e++){audio.buffered.start(e),audio.buffered.end(e)}}),Audio.prototype.play=function(a){return function(){return audio.playing=!0,progressInterval=setInterval(function(){$("#progress").css("margin-left","+="+pps),e.$apply(function(){e.currentTime=audio.currentTime,e.currentTimeFormatted=i(Math.ceil(audio.currentTime))}),audio.currentTime>=m.totalSeconds&&e.shuffle(!1)},1e3),a.apply(this,arguments)}}(Audio.prototype.play),Audio.prototype.pause=function(e){return function(){return this.playing&&(clearInterval(progressInterval),this.playing=!1),e.apply(this,arguments)}}(Audio.prototype.pause),e.changeAlbum=function(a,t,n){e.albumIndex=a,$("#cover").attr("src",playlist[a].albumart),"undefined"!=typeof t?n?e.changeAudio(e.albumIndex,e.songIndex,!0):e.changeAudio(e.albumIndex,e.songIndex,!1):e.shuffle()},e.shuffle=function(a){a?(e.songIndex=Math.floor(Math.random()*playlist[e.albumIndex].album.length)+0,e.changeAudio(e.albumIndex,e.songIndex)):e.songNavigation(!0)},e.changeAudio=function(a,t,n){e.song=e.playlist[e.albumIndex].album[t].name,e.artist=e.playlist[e.albumIndex].artist,e.songIndex=t;var i=playlist[e.albumIndex].album[e.songIndex].path;audio.playing?(audio.stop(),clearInterval(progressInterval),n&&(o("pause",!0),setTimeout(function(){o("play")},200))):o("play"),delete audio,audio=new Audio(i),audio.prepare(),audio.play()},e.songNavigation=function(a){var t=playlist[e.albumIndex].album.length-1;a&&(e.songIndex==t?e.changeAudio(e.albumIndex,0):(e.songIndex++,e.changeAudio(e.albumIndex,e.songIndex))),a||(0==e.songIndex?e.changeAudio(e.albumIndex,t):(e.songIndex--,e.changeAudio(e.albumIndex,e.songIndex)))},$("#container").on("click","#play",function(){playable?audio.playable&&(audio.play(),o("play")):n("Loading...")}),$("#container").on("click","#pause",function(){audio.pause(),o("pause")}),$("#progressBar").mousemove(function(e){var a=e.pageX-$(this).offset().left,t=a-$("#tail").width()/3;.3>=t?$("#tail").css("margin-left",1):t>=309?$("#tail").css("margin-left",309):$("#tail").css("margin-left",t);var n=Math.floor(a/pps);i(n),$("#tail").html(m.formatted)}).mouseleave(function(){$("#tail").fadeOut()}).mouseenter(function(){$("#tail").fadeIn()}).click(function(e){var a=e.pageX-$(this).offset().left,t=Math.floor(a/pps);audio.currentTime=t,$("#progress").css("margin-left",pps*t)});var c=!1;$("body").on("mousedown","#progress",function(e){e.preventDefault(),$("#progress").addClass("mouseDown draggable"),c=!0,$("#container").mousemove(function(e){e.pageX-$("#progressBar").offset().left;$(".draggable").css({"margin-left":e.pageX-$("#progressBar").offset().left-5})}).mouseleave(function(e){if(c){$("#progress").removeClass("draggable mouseDown");var a=e.pageX-$("#progressBar").offset().left;0>a&&($("#progress").css({"margin-left":0}),audio.currentTime=0),a>350&&($("#progress").css({"margin-left":347}),audio.currentTime=m.totalSeconds);var t=Math.floor(a/pps);audio.currentTime=t,c=!1}})}),$("body").on("mouseup","#container",function(e){if(c){var a=e.pageX-$("#progressBar").offset().left,t=Math.floor(a/pps);audio.currentTime=t,$("#progress").removeClass("draggable mouseDown"),c=!1}}),$("#volume").change(function(){e.inControl?e.volume=this.value/100:(audio.volume=this.value/100,e.volume=audio.volume,e.$apply())}),e.keyUpsHandler=function(a){switch(a){case 13:e.login();break;case 32:audio.playing?$("#pause").click():$("#play").click();break;case 78:e.songNavigation(!0);break;case 80:e.songNavigation(!1);break;case 49:e.changeAlbum(0);break;case 50:e.changeAlbum(1);break;case 51:e.changeAlbum(2,0);break;case 52:e.changeAlbum(3,1);break;case 191:$("#infoCard").fadeToggle()}},$("#preview").hover(function(){$("#preview")[0].play()});var d;e.login=function(){0==e.loggedIn&&(e.loggedIn=!0,t.authWithOAuthPopup("google",function(a,t){a?(e.loggedIn=!1,e.$apply()):(d=new r(t.uid,t.google.displayName,t.google.profileImageURL),e.logout=function(){e.loggedIn=!1,d.logout()})}))},String.prototype.format=function(){var e=this;for(var a in arguments)e=e.replace("{"+a+"}",arguments[a]);return e},$("#rating").mousemove(function(e){for(var a=e.pageX-$(this).offset().left,t=0,n=24;5>t;t++,n+=38)a>n&&220>a?$("#rating .material-icons").eq(t).html("star"):n>a&&$("#rating .material-icons").eq(t).html("star_border")});var g;e.rate=function(a){$("#rating").addClass("rateToggle"),$("#rating .material-icons").eq(5).toggleClass("expandToggle"),d.rateAlbum(e.albumToRate,a),g=setTimeout(function(){$("#ratingCardWrapper").removeClass("show"),e.showStars()},3e3)},e.showStars=function(){$("#rating").removeClass("rateToggle"),$("#rating .material-icons").eq(5).toggleClass("expandToggle"),clearTimeout(g)},e.showRatingCard=function(a){e.albumToRate=a,e.loggedIn?(e.ratingList[a]?(l(!1),l(e.ratingList[a])):l(!1),e.selectedAlbumName=e.playlist[a].name,e.selectedAlbumArtist=e.playlist[a].artist,e.selectedAlbumArt=e.playlist[a].albumart,$("html, body").animate({scrollTop:$(document).height()},"slow"),$("#ratingCardWrapper").addClass("show")):(n("Please login to rate albums"),$("#devicesPage").click())},e.loadAlbum=function(){setTimeout(function(){$(".albumCard").addClass("show"),$(".albumCard").removeClass("hide")},500),setTimeout(function(){},1500)};var p=!0;$(".albumImage").click(function(){if(p){p=!1;var a=this;e.$apply(function(){e.song=e.playlist[a.id].album[0].name,e.artist=e.playlist[a.id].artist}),v&&b(!1),f($(this),!0),f($(this).siblings(".info"),!1),$(this).toggleClass("animate defaultPosition"),$(this).siblings(".info").toggleClass("animate defaultPosition"),$(this).siblings(".info").find(".text").addClass("animate"),$("#fakeButton").addClass("show"),setTimeout(function(){$("#movingContainer").removeClass("animate"),$("#playerPage").click(),$(a).toggleClass("animate defaultPosition"),$(a).siblings(".info").toggleClass("animate defaultPosition"),$(a).siblings(".info").find(".text").removeClass("animate"),$("#fakeButton").removeClass("show"),e.changeAlbum(a.id,0,!0)},1e3),setTimeout(function(){$("#movingContainer").addClass("animate")},1200),setTimeout(function(){p=!0},1500)}});var f=function(e,a){var t={top:0,left:0},n=e.position().top,o=e.position().left;a&&n!==t.top&&e.css({"margin-top":-(n-t.top)}),o<t.left&&e.css({"margin-left":o-t.left}),o>t.left&&e.css({"margin-left":-(o-t.left)})},h=!0,v=!1,b=function(e){e||($("#cover").addClass("noTransition"),$("#imgOverlay").addClass("noTransition"),setTimeout(function(){$("#cover").removeClass("noTransition"),$("#imgOverlay").removeClass("noTransition")},1e3)),h&&(h=!1,$(this).children("i").toggleClass("black"),v?v&&(v=!1,$("#imgOverlay").removeClass("animate"),$("#cover").addClass("animate"),$("#cover").removeClass("clip")):(v=!0,$("#cover").removeClass("animate"),$("#imgOverlay").addClass("animate"),setTimeout(function(){$("#cover").addClass("clip")},500)),setTimeout(function(){h=!0},500))};$("#playlistBtn").click(function(){b(!0)}),e.chooseSong=function(a){e.changeAudio(e.albumIndex,a,!1)}})}]);